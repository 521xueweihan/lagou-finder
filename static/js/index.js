// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var addMarker, map, point, top_left_control, top_left_navigation;
    map = new BMap.Map("allmap");
    point = new BMap.Point(116.404, 39.915);
    map.centerAndZoom(point, 14);
    top_left_control = new BMap.ScaleControl({
      anchor: BMAP_ANCHOR_TOP_LEFT
    });
    map.addControl(top_left_control);
    top_left_navigation = new BMap.NavigationControl();
    map.addControl(top_left_navigation);
    addMarker = function(job) {
      var infoWindow, marker, sContent;
      point = new BMap.Point(job['lng'], job['lat']);
      marker = new BMap.Marker(point);
      map.addOverlay(marker);
      sContent = "<p> 职位：" + job.title + " <br/> 公司：" + job.company_name + " " + job.company_size + " <br/> 资金：" + job.stage + " <br/> 地址：" + job.location + " <br/> 待遇：" + job.salary + " <br/> 来源：<a href='http://www.lagou.com/jobs/" + job.jid + ".html'>拉勾网</a> </p>";
      infoWindow = new BMap.InfoWindow(sContent);
      return marker.addEventListener("click", function() {
        this.openInfoWindow(infoWindow);
        return document.getElementById('imgDemo').onload = function() {
          return infoWindow.redraw();
        };
      });
    };
    return $.getJSON('/api/jobs').success(function(data) {
      var i, job, len, ref, results;
      if ((data.error == null) || data.error !== 0) {
        return true;
      }
      ref = data['items'];
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        job = ref[i];
        results.push(addMarker(job));
      }
      return results;
    });
  });

}).call(this);

//# sourceMappingURL=index.js.map
